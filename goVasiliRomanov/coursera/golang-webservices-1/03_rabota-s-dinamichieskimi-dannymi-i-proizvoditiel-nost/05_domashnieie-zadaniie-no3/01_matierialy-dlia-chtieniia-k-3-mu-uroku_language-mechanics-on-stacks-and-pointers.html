<!doctype html><html lang=en-us class=labs_live_alert_open><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content="Ardan Labs,Go,Programming,Blog,Go Programming,Golang"><title>Language Mechanics On Stacks And Pointers</title><script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-PHCW7L4');</script><meta name=description content="Prelude This is the first post in a four part series that will provide an understanding of the mechanics and design behind pointers, stacks, heaps, escape analysis and value/pointer semantics in Go. This post focuses on stacks and pointers. Index of the four part series: 1) Language Mechanics On Stacks And Pointers 2) Language Mechanics On Escape Analysis 3) Language Mechanics On Memory Profiling 4) Design Philosophy On Data And Semantics"><meta property=og:title content="Language Mechanics On Stacks And Pointers"><meta property=og:type content=website><meta property=og:description content="Our Blog is a great source of insights about Go, also referred as &amp;quot;golang&amp;quot;. Our main contributor Bill Kennedy is a renowned Go Trainer, consultant, and author."><meta property=og:url content=https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-stacks-and-pointers.html><meta property=og:locale content=en><meta property=og:image content=http://ardanlabs.com/images/ardan-labs.jpg><meta property=og:image:secure_url content=https://www.ardanlabs.com/images/ardan-labs.jpg><meta property=og:type content=website><meta property=twitter:description content="Our Blog is a great source of insights about Go, also referred as &amp;quot;golang&amp;quot;. Our main contributor Bill Kennedy is a renowned Go Trainer, consultant, and author."><meta property=twitter:title content="Language Mechanics On Stacks And Pointers"><meta property=twitter:image content=http://ardanlabs.com/images/ardan-labs-twitter-card.jpg><meta property=twitter:image:secure_url content=https://www.ardanlabs.com/images/ardan-labs-twitter-card.jpg><meta name=twitter:card content=summary_large_image><meta name=generator content="Hugo 0.47"><link rel=stylesheet href=https://www.ardanlabs.com/css/bundle.min.8b015d3e2805a934c7bfe1cbaae3cba4a45ae58042b382fbe1e37a7e460c5e54.css><link href="https://fonts.googleapis.com/css?family=Titillium+Web:300,400,500,700" rel=stylesheet><link rel="shortcut icon" href=https://www.ardanlabs.com/favicon.ico type=image/x-icon></head><body class=blog><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PHCW7L4" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><section class=alert-wrapper><div class="alert fade-in labs-live-alert" role=alert><button type=button class=close data-dismiss=alert aria-label=Close>
<span aria-hidden=true>×</span></button><p><strong>Ardan Labs Live |</strong> Join us for a month of classes & free talks to grow your engineering skills.
<a href=/ardan-labs-live>Explore Events <i class="fa fa-angle-right" aria-hidden=true></i></a><div id=content class=container><div id=countdown><ul><li><span id=days></span>d<li><span id=hours></span>h<li><span id=minutes></span>m<li><span id=seconds></span>s</ul></div></div><script>(function(){const second=1000,minute=second*60,hour=minute*60,day=hour*24;let today=new Date(),dd=String(today.getDate()).padStart(2,"0"),mm=String(today.getMonth()+1).padStart(2,"0"),yyyy=today.getFullYear(),nextYear=yyyy+1,dayMonth="02/16/",birthday=dayMonth+yyyy;today=mm+"/"+dd+"/"+yyyy;if(today>birthday){birthday=dayMonth+nextYear;}
const countDown=new Date(birthday).getTime(),x=setInterval(function(){const now=new Date().getTime(),distance=countDown-now;document.getElementById("days").innerText=Math.floor(distance/(day)),document.getElementById("hours").innerText=Math.floor((distance%(day))/(hour)),document.getElementById("minutes").innerText=Math.floor((distance%(hour))/(minute)),document.getElementById("seconds").innerText=Math.floor((distance%(minute))/second);if(distance<0){document.getElementById("countdown").style.display="none";document.getElementById("content").style.display="block";clearInterval(x);}},0)}());</script></div></section><div class="nav-wrap affix-top"><nav><div class=nav-inner><div class=nav-brand><a href=/><img src=https://www.ardanlabs.com/images/ardanlabs-logo.svg alt="Ardan Labs"></a></div><div class=nav-links><ul class=main><li class=training><a class="menu-toggle training_menu" href=#.>Training
<span><i class="fa fa-chevron-up" aria-hidden=true></i></span></a><div class=nav-dropdown><div class="nav-dropdown-inner parent-flex"><div class=main-links><p>Our training paths<ul><li><a class=all_training href=/training><span><img src=https://www.ardanlabs.com/images/drop-menu-all-icon.svg alt="Ardan Labs"></span> All Training</a><li><a class=on_demand href=/education target=_blank><span><img src=https://www.ardanlabs.com/images/drop-menu-video-icon.svg alt="Ardan Labs"></span> On-Demand</a><li><a class=ardan_labs_live href=/ardan-labs-live/><span><img src=https://www.ardanlabs.com/images/drop-menu-live-icon.svg alt="Ardan Labs"></span> Ardan Labs Live<br><i class=dates>Feb 28 - Apr 8</i></a></ul></div><div class=sub-links><p>Grow your skills<ul><li><a class=go_training_link href=/ultimate-go>Go</a><li><a class=k8s_training_link href=/intensive-docker-kubernetes>K8s</a><li><a class=python_training_link href=/python-training>Python</a><li><a class=terraform_training_link href=/terraform-training>Terraform</a><li><a class=dgraph_training_link href=/ultimate-dgraph>Dgraph</a></ul></div></div></div><li class=consulting><a href=/development>Development</a><li class=devops><a href=/devops-consulting>DevOps</a><li class=blockchain><a href=/blockchain>Blockchain</a><li class=staffing><a class=consulting_click href=/staffing>Staffing</a><li class=careers><a href=/careers>Careers</a><li class=blog><a href=/blog>Blog</a></ul><ul class=util><li><a href=https://courses.ardanlabs.com/users/sign_in>Sign In</a><li class="contact letstalk"><button type=button class="btn btn-lets-talk lets_talk_btn" data-toggle=modal data-target=#contactModal data-lets-talk=lets-talk-nav>
<i class="fa fa-comments-o" aria-hidden=true></i>&nbspLet's Talk</button></ul></div><div class=nav-mobile><button class="hamburger navbar-toggler second-button" type=button data-toggle=collapse data-target=#navbarSupportedContent23 aria-controls=navbarSupportedContent23 aria-expanded=false aria-label="Toggle navigation"><div class=animated-icon2><span></span><span></span><span></span><span></span></div></button>
<button type=button class="btn btn-lets-talk" data-toggle=modal data-target=#contactModal>
<i class="fa fa-comments-o" aria-hidden=true></i>&nbspLet's Talk</button></div></div></nav></div><div style=display:none class=div-fix style=height:0;width:100% id=nav><nav class="navbar navbar-default" data-spy=affix data-offset-top=0><div class=container-fluid><div class=navbar-header><button type=button class=navbar-toggle data-toggle=collapse data-target=#navbar-collapse>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span><span class=icon-bar></span><span class=icon-bar></span></button><div class=brand-box></div><button type=button class=btn data-toggle=modal data-target=#contactModal>
<i class="fa fa-comments-o" aria-hidden=true></i>&nbspLet's Talk</button></div><div class="collapse navbar-collapse" id=navbar-collapse><ul class="nav navbar-nav navbar-right"><div class=modal-header><li class=go-training><a href=/training>Training</a><li class=consulting><a href=/development>Development</a><li class=devops><a href=/devops-consulting>DevOps</a><li class=staffing><a class=consulting_click href=/staffing>Staffing</a><li class=careers><a href=/careers>Careers</a><li class=about><a href=/about>About</a><li class=blog><a href=/blog>Blog</a><li class="contact letstalk"><button type=button class=btn data-toggle=modal data-target=#contactModal>
<i class="fa fa-comments-o" aria-hidden=true></i>&nbspLet's Talk</button></ul></div></div></nav></div><div class=content><header class=blog-header><div class=container><div class=row><div class=col-lg-12><div class=header-intro><h2 class=title>Subscribe to the Ardan Labs <span>Insider</span></h2><p class=into-text>You’ll get our <b>FREE</b> Video Series & special offers on upcoming training events along with notifications on our latest blog posts.<div class=alternate><b>Included in your subscription</b><ul><li><i class="fa fa-check-circle" aria-hidden=true></i>Access to our free video previews<li><i class="fa fa-check-circle" aria-hidden=true></i>Updates on our latest blog posts<li><i class="fa fa-check-circle" aria-hidden=true></i>Discounts on upcoming events</ul></div><form class=subscriber-form><div class="form-wrap parent-flex"><input type=hidden id=tags name=tags value=Blog>
<input class=form-control name=email placeholder="email address">
<input type=submit value=Subscribe href=https://www.ardanlabs.com/subscribe class="btn btn-lets-talk subscribebtn"><p class=error-message>Valid email required.<p class=failed-message>Submit failed. Try again or message us directly at <a href=mailto:hello@ardanlabs.com class=text-link>hello@ardanlabs.com.</a></div><div class=confirmation-message><img src=https://www.ardanlabs.com/images/check.svg><h1>Thank You for Subscribing</h1><p>Check your email for confirmation.</div></form></div></div></div></div></header><section class=ribbon-slider><div id=promo-ribbon class="carousel slide" data-ride=carousel><div class=carousel-inner role=listbox><div class="item active"><a href=/ardan-labs-live class="ribbon-slider-link ardan_labs_live_click"><p><img src=https://www.ardanlabs.com/images/live-promo-small.png><b>Ardan Labs Live</b>: Feb 28th - Apr 8th, 2022 <span>Explore Events</span></p></a></div><div class=item class=ultimate_go_notebook_click><a class=ribbon-slider-link href=https://courses.ardanlabs.com/courses/ultimate-go-notebook target=_blank><p><img src=https://www.ardanlabs.com/images/book-promo-img-small.png>Introducing the <b>Ultimate Go Notebook</b>. Turn your programming into engineering. <span>Get your copy</span></p></a></div><div class=item class=education_click><a class=ribbon-slider-link href=https://www.ardanlabs.com/education/ target=_blank><p><img src=https://www.ardanlabs.com/images/edu-cert.png>Advanced Self-Paced Video Training. Learn <b>Go</b>, <b>K8s</b> & grow your engineering skills. <span>Free Preview</span></p></a></div></div><a class="left carousel-control" href=#promo-ribbon role=button data-slide=prev><span class="glyphicon glyphicon-chevron-left fa fa-angle-left" aria-hidden=true></span><span class=sr-only>Previous</span></a>
<a class="right carousel-control" href=#promo-ribbon role=button data-slide=next><span class="glyphicon glyphicon-chevron-right fa fa-angle-right" aria-hidden=true></span><span class=sr-only>Next</span></a></div></section><div class=container><ul class=breadcrumbs><li><a href=/>Home ></a><li><a href=/blog>Blog ></a><li id=title>Language Mechanics On Stacks And Pointers</ul><div class=row><div class=col-lg-12><div class=blog-links><a href=https://www.ardanlabs.com/all-posts class="btn btn-secondary-outline"><i class="fa fa-list" aria-hidden=true></i>&nbsp;
List All Posts</a>
<a id=rsslinkbtn data-toggle=popover data-placement=top data-content="RSS link copied to clipboard" class="btn btn-secondary-outline" data-clipboard-text=https://www.ardanlabs.com/blog/index.xml><i class="fa fa-rss" aria-hidden=true></i>&nbsp; RSS</a></div><div class=clearfix></div><div class=single-post><header><h1 class=title>Language Mechanics On Stacks And Pointers</h1><div class=author-flex><span class=author-section><img class=author-thumb src=https://www.ardanlabs.com//images/avatar-william-Kennedy.jpg alt="Author image" nopin=nopin></span><div class=author-info><span class=author-section><p class=author-name>William Kennedy</p><span class=post-date>May 18, 2017</span><ul class=author-social><li class=icon><a href=mailto:bill@ardanlabs.com title=bill@ardanlabs.com><i class="fa fa-envelope-o" aria-hidden=true></i></a><li class=icon><a href=https://github.com/ardanlabs/gotraining title=ardanlabs/gotraining target=_blank><i class="fa fa-github-square" aria-hidden=true></i></a><li class=icon><a href=https://twitter.com/goinggodotnet title=goinggodotnet target=_blank><i class="fa fa-twitter-square" aria-hidden=true></i></a></ul></span></div></div></header><section class=post-content><h3 id=prelude>Prelude</h3><p>This is the first post in a four part series that will provide an understanding of the mechanics and design behind pointers, stacks, heaps, escape analysis and value/pointer semantics in Go. This post focuses on stacks and pointers.<p>Index of the four part series:<br>1) <a href=https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-stacks-and-pointers.html>Language Mechanics On Stacks And Pointers</a><br>2) <a href=https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-escape-analysis.html>Language Mechanics On Escape Analysis</a><br>3) <a href=https://www.ardanlabs.com/blog/2017/06/language-mechanics-on-memory-profiling.html>Language Mechanics On Memory Profiling</a><br>4) <a href=https://www.ardanlabs.com/blog/2017/06/design-philosophy-on-data-and-semantics.html>Design Philosophy On Data And Semantics</a><h3 id=introduction>Introduction</h3><p>I’m not going to sugar coat it, pointers are difficult to comprehend. When used incorrectly, pointers can produce nasty bugs and even performance issues. This is especially true when writing concurrent or multi-threaded software. It’s no wonder so many languages attempt to hide pointers away from programmers. However, if you are writing software in Go, there is no way for you to avoid them. Without a strong understanding of pointers, you will struggle to write clean, simple and efficient code.<h3 id=frame-boundaries>Frame Boundaries</h3><p>Functions execute within the scope of frame boundaries that provide an individual memory space for each respective function. Each frame allows a function to operate within their own context and also provides flow control. A function has direct access to the memory inside its frame, through the frame pointer, but access to memory outside its frame requires indirect access. For a function to access memory outside of its frame, that memory must be shared with the function. The mechanics and restrictions established by these frame boundaries need to be understood and learned first.<p>When a function is called, there is a transition that takes place between two frames. The code transitions out of the calling function&rsquo;s frame and into the called function&rsquo;s frame. If data is required to make the function call, then that data must be transferred from one frame to the other. The passing of data between two frames is done &ldquo;by value&rdquo; in Go.<p>The benefit of passing data &ldquo;by value&rdquo; is readability. The value you see in the function call is what is copied and received on the other side. It&rsquo;s why I relate &ldquo;pass by value&rdquo; with WYSIWYG, because what you see is what you get. All of this allows you to write code that does not hide the cost of the transition between the two functions. This helps to maintain a good mental model of how each function call is going to impact the program when the transition take place.<p>Look at this small program that performs a function call passing integer data &ldquo;by value&rdquo;:<p><strong>Listing 1</strong><pre><code>01 package main
02
03 func main() {
04
05    // Declare variable of type int with a value of 10.
06    count := 10
07
08    // Display the &quot;value of&quot; and &quot;address of&quot; count.
09    println(&quot;count:\tValue Of[&quot;, count, &quot;]\tAddr Of[&quot;, &amp;count, &quot;]&quot;)
10
11    // Pass the &quot;value of&quot; the count.
12    increment(count)
13
14    println(&quot;count:\tValue Of[&quot;, count, &quot;]\tAddr Of[&quot;, &amp;count, &quot;]&quot;)
15 }
16
17 //go:noinline
18 func increment(inc int) {
19
20    // Increment the &quot;value of&quot; inc.
21    inc++
22    println(&quot;inc:\tValue Of[&quot;, inc, &quot;]\tAddr Of[&quot;, &amp;inc, &quot;]&quot;)
23 }
</code></pre><p>When your Go program starts up, the runtime creates the main goroutine to start executing all the initialization code including the code inside the <code>main</code> function. A goroutine is a path of execution that is placed on an operating system thread that eventually executes on some core. As of version 1.8, every goroutine is given an initial 2,048 byte block of contiguous memory which forms its stack space. This initial stack size has changed over the years and could change again in the future.<p>The stack is important because it provides the physical memory space for the frame boundaries that are given to each individual function. By the time the main goroutine is executing the <code>main</code> function in Listing 1, the goroutine’s stack (at a very high level) would look like this:<p><strong>Figure 1</strong><p><img src=../../../images/goinggo/80_figure1.png alt><p>You can see in Figure 1, a section of the stack has been &ldquo;framed&rdquo; out for the <code>main</code> function. This section is called a &ldquo;stack frame&rdquo; and it&rsquo;s this frame that denotes the <code>main</code> function&rsquo;s boundary on the stack. The frame is established as part of the code that is executed when the function is called. You can also see the memory for the <code>count</code> variable has been placed at address <code>0x10429fa4</code> inside the frame for <code>main</code>.<p>There is another interesting point made clear by Figure 1. All stack memory below the active frame is invalid but memory from the active frame and above is valid. I need to be clear about the boundary between the valid and invalid parts of the stack.<h3 id=addresses>Addresses</h3><p>Variables serve the purpose of assigning a name to a specific memory location for better code readability and to help you reason about the data you are working with. If you have a variable then you have a value in memory, and if you have a value in memory then it must have an address. On line 09, the <code>main</code> function calls the built-in function <code>println</code> to display the &ldquo;value of&rdquo; and &ldquo;address of&rdquo; the <code>count</code> variable.<p><strong>Listing 2</strong><pre><code>09    println(&quot;count:\tValue Of[&quot;, count, &quot;]\tAddr Of[&quot;, &amp;count, &quot;]&quot;)
</code></pre><p>The use of the ampersand <code>&amp;</code> operator to get the address of a variable&rsquo;s location is not novel, other languages use this operator as well. The output of line 09 should be similar to the output below if you run the code on a 32bit architecture like the playground:<p><strong>Listing 3</strong><pre><code>count:  Value Of[ 10 ]  Addr Of[ 0x10429fa4 ]
</code></pre><h3 id=function-calls>Function Calls</h3><p>Next on line 12, the <code>main</code> function makes a call into the <code>increment</code> function.<p><strong>Listing 4</strong><pre><code>12    increment(count)
</code></pre><p>Making a function call means the goroutine needs to frame a new section of memory on the stack. However, things are a bit more complicated. To successfully make this function call, data is expected to be passed across the frame boundary and placed into the new frame during the transition. Specifically an integer value is expected to be copied and passed during the call. You can see this requirement by looking at the declaration of the <code>increment</code> function on line 18.<p><strong>Listing 5</strong><pre><code>18 func increment(inc int) {
</code></pre><p>If you look at the function call to <code>increment</code> again on line 12, you can see the code is passing the &ldquo;value of&rdquo; the <code>count</code> variable. This value will be copied, passed and placed into the new frame for the <code>increment</code> function. Remember the <code>increment</code> function can only directly read and write to memory within its own frame, so it needs the <code>inc</code> variable to receive, store and access its own copy of the <code>count</code> value being passed.<p>Just before the code inside the <code>increment</code> function starts executing, the goroutine’s stack (at a very high level) would look like this:<p><strong>Figure 2</strong><p><img src=../../../images/goinggo/80_figure2.png alt><p>You can see the stack now has two frames, one for <code>main</code> and below that, one for <code>increment</code>. Inside the frame for <code>increment</code>, you see the <code>inc</code> variable and it contains the value of <code>10</code> that was copied and passed during the function call. The address of the <code>inc</code> variable is <code>0x10429f98</code> and is lower in memory because frames are taken down the stack, which is just an implementation detail that doesn&rsquo;t mean anything. What&rsquo;s important is that the goroutine took the value of <code>count</code> from within the frame for <code>main</code> and placed a copy of that value within the frame for <code>increment</code> using the <code>inc</code> variable.<p>The rest of the code inside of <code>increment</code> increments and displays the &ldquo;value of&rdquo; and &ldquo;address of&rdquo; the <code>inc</code> variable.<p><strong>Listing 6</strong><pre><code>21    inc++
22    println(&quot;inc:\tValue Of[&quot;, inc, &quot;]\tAddr Of[&quot;, &amp;inc, &quot;]&quot;)
</code></pre><p>The output of line 22 on the playground should look something like this:<p><strong>Listing 7</strong><pre><code>inc:    Value Of[ 11 ]  Addr Of[ 0x10429f98 ]
</code></pre><p>This is what the stack looks like after the execution of those same lines of code:<p><strong>Figure 3</strong><p><img src=../../../images/goinggo/80_figure3.png alt><p>After lines 21 and 22 are executed, the <code>increment</code> function returns and control goes back to the <code>main</code> function. Then the <code>main</code> function displays the &ldquo;value of&rdquo; and &ldquo;address of&rdquo; the local <code>count</code> variable again on line 14.<p><strong>Listing 8</strong><pre><code>14    println(&quot;count:\tValue Of[&quot;,count, &quot;]\tAddr Of[&quot;, &amp;count, &quot;]&quot;)
</code></pre><p>The full output of the program on the playground should look something like this:<p><strong>Listing 9</strong><pre><code>count:  Value Of[ 10 ]  Addr Of[ 0x10429fa4 ]
inc:    Value Of[ 11 ]  Addr Of[ 0x10429f98 ]
count:  Value Of[ 10 ]  Addr Of[ 0x10429fa4 ]
</code></pre><p>The value of <code>count</code> in the frame for <code>main</code> is the same before and after the call to <code>increment</code>.<h3 id=function-returns>Function Returns</h3><p>What actually happens to the memory on the stack when a function returns and control goes back up to the calling function? The short answer is nothing. This is what the stack looks like after the return of the <code>increment</code> function:<p><strong>Figure 4</strong><p><img src=../../../images/goinggo/80_figure4.png alt><p>The stack looks exactly the same as Figure 3 except the frame associated with the <code>increment</code> function is now considered to be invalid memory. This is because the frame for <code>main</code> is now the active frame. The memory that was framed for the <code>increment</code> function is left untouched.<p>It would be a waste of time to clean up the memory of the returning function&rsquo;s frame because you don&rsquo;t know if that memory will ever be needed again. So the memory is left the way it is. It&rsquo;s during each function call, when the frame is taken, that the stack memory for that frame is wiped clean. This is done through the initialization of any values that are placed in the frame. Because all values are initialized to at least their &ldquo;zero value&rdquo;, stacks clean themselves properly on every function call.<h3 id=sharing-values>Sharing Values</h3><p>What if it was important for the <code>increment</code> function to operate directly on the <code>count</code> variable that exists inside the frame for <code>main</code>? This is where pointers come in. Pointers serve one purpose, to share a value with a function so the function can read and write to that value even though the value does not exist directly inside its own frame.<p>If the word &ldquo;share&rdquo; doesn&rsquo;t come out of your mouth, you don&rsquo;t need to use a pointer. When learning about pointers, it&rsquo;s important to think using a clear vocabulary and not operators or syntax. So remember, pointers are for sharing and replace the <code>&amp;</code> operator for the word &ldquo;sharing&rdquo; as you read code.<h3 id=pointer-types>Pointer Types</h3><p>For every type that is declared, either by you or the language itself, you get for free a complement pointer type you can use for sharing. There already exists a built-in type named <code>int</code> so there is a complement pointer type called <code>*int</code>. If you declare a type named <code>User</code>, you get for free a pointer type called <code>*User</code>.<p>All pointer types have the same two characteristics. First, they start with the character <code>*</code>. Second, they all have the same memory size and representation, which is a 4 or 8 bytes that represent an address. On 32bit architectures (like the playground), pointers require 4 bytes of memory and on 64bit architectures (like your machine), they require 8 bytes of memory.<p><em>In the spec, <a href=https://golang.org/ref/spec#PointerType>pointer types</a> are considered to be <a href=https://golang.org/ref/spec#Types>type literals</a>, which mean they are unnamed types composed from an existing type.</em><h3 id=indirect-memory-access>Indirect Memory Access</h3><p>Look at this small program that performs a function call passing an address &ldquo;by value&rdquo;. This will share the <code>count</code> variable from the <code>main</code> stack frame with the <code>increment</code> function:<p><strong>Listing 10</strong><pre><code>01 package main
02
03 func main() {
04
05    // Declare variable of type int with a value of 10.
06    count := 10
07
08    // Display the &quot;value of&quot; and &quot;address of&quot; count.
09    println(&quot;count:\tValue Of[&quot;, count, &quot;]\t\tAddr Of[&quot;, &amp;count, &quot;]&quot;)
10
11    // Pass the &quot;address of&quot; count.
12    increment(&amp;count)
13
14    println(&quot;count:\tValue Of[&quot;, count, &quot;]\t\tAddr Of[&quot;, &amp;count, &quot;]&quot;)
15 }
16
17 //go:noinline
18 func increment(inc *int) {
19
20    // Increment the &quot;value of&quot; count that the &quot;pointer points to&quot;. (dereferencing)
21    *inc++
22    println(&quot;inc:\tValue Of[&quot;, inc, &quot;]\tAddr Of[&quot;, &amp;inc, &quot;]\tValue Points To[&quot;, *inc, &quot;]&quot;)
23 }
</code></pre><p>There are three interesting changes that were made to this program from the original. Here is the first change on line 12:<p><strong>Listing 11</strong><pre><code>12    increment(&amp;count)
</code></pre><p>This time on line 12, the code is not copying and passing the &ldquo;value of&rdquo; <code>count</code> but instead the &ldquo;address of&rdquo; <code>count</code>. You can now say, I am &ldquo;sharing&rdquo; the <code>count</code> variable with the <code>increment</code> function. This is what the <code>&amp;</code> operator says, &ldquo;sharing&rdquo;.<p>Understand this is still a &ldquo;pass by value&rdquo;, the only difference is the value you are passing is an address instead of an integer. Addresses are values too; this is what is being copied and passed across the frame boundary for the function call.<p>Since the value of an address is being copied and passed, you need a variable inside the frame of <code>increment</code> to receive and store this integer based address. This is where the declaration of the integer pointer variable comes in on line 18.<p><strong>Listing 12</strong><pre><code>18 func increment(inc *int) {
</code></pre><p>If you were passing the address of a <code>User</code> value, then the variable would have needed to be declared as a <code>*User</code>. Even though all pointer variables store address values, they can&rsquo;t be passed any address, only addresses associated with the pointer type. This is the key, the reason to share a value is because the receiving function needs to perform a read or write to that value. You need the type information of any value in order to read and write to it. The compiler will make sure that only values associated with the correct pointer type are shared with that function.<p>This is what the stack looks like after the function call to <code>increment</code>:<p><strong>Figure 5</strong><p><img src=../../../images/goinggo/80_figure5.png alt><p>You can see in figure 5 what the stack looks like when a &ldquo;pass by value&rdquo; is performed using an address as the value. The pointer variable inside the frame for the <code>increment</code> function is now pointing to the <code>count</code> variable, which is located inside the frame for <code>main</code>.<p>Now using the pointer variable, the function can perform an indirect read modify write operation to the <code>count</code> variable located inside the frame for <code>main</code>.<p><strong>Listing 13</strong><pre><code>21    *inc++
</code></pre><p>This time the <code>*</code> character is acting as an operator and being applied against the pointer variable. Using the <code>*</code> as an operator means, &ldquo;the value that the pointer points to&rdquo;. The pointer variable allows indirect memory access outside of the function&rsquo;s frame that is using it. Sometimes this indirect read or write is called dereferencing the pointer. The <code>increment</code> function still must have a pointer variable within its frame it can directly read to perform the indirect access.<p>Now in figure 6 you see what the stack looks like after the execution of line 21.<p><strong>Figure 6</strong><p><img src=../../../images/goinggo/80_figure6.png alt><p>Here is the final output of this program:<p><strong>Listing 14</strong><pre><code>count:  Value Of[ 10 ]   	   	Addr Of[ 0x10429fa4 ]
inc:    Value Of[ 0x10429fa4 ]  	Addr Of[ 0x10429f98 ]   Value Points To[ 11 ]
count:  Value Of[ 11 ]   	   	Addr Of[ 0x10429fa4 ]
</code></pre><p>You can see the &ldquo;value of&rdquo; the <code>inc</code> pointer variable is the same as the &ldquo;address of&rdquo; the <code>count</code> variable. This sets up the sharing relationship that allowed the indirect access to the memory outside of the frame to take place. Once the write is performed by the <code>increment</code> function through the pointer, the change is seen by the <code>main</code> function when control is returned.<h3 id=pointer-variables-are-not-special>Pointer Variables Are Not Special</h3><p>Pointer variables are not special because they are variables like any other variable. They have a memory allocation and they hold a value. It just so happens that all pointer variables, regardless of the type of value they can point to, are always the same size and representation. What can be confusing is the <code>*</code> character is acting as an operator inside the code and is used to declare the pointer type. If you can distinguish the type declaration from the pointer operation, this can help alleviate some confusion.<h3 id=conclusion>Conclusion</h3><p>This post has described the purpose behind pointers and how stack and pointer mechanics work in Go. This is the first step in understanding the mechanics, design philosophies and guidelines needed for writing consistent and readable code.<p>In summary this is what you learned:<ul><li>Functions execute within the scope of frame boundaries that provide an individual memory space for each respective function.<li>When a function is called, there is a transition that takes place between two frames.<li>The benefit of passing data &ldquo;by value&rdquo; is readability.<li>The stack is important because it provides the physical memory space for the frame boundaries that are given to each individual function.<li>All stack memory below the active frame is invalid but memory from the active frame and above is valid.<li>Making a function call means the goroutine needs to frame a new section of memory on the stack.<li>It&rsquo;s during each function call, when the frame is taken, that the stack memory for that frame is wiped clean.<li>Pointers serve one purpose, to share a value with a function so the function can read and write to that value even though the value does not exist directly inside its own frame.<li>For every type that is declared, either by you or the language itself, you get for free a compliment pointer type you can use for sharing.<li>The pointer variable allows indirect memory access outside of the function&rsquo;s frame that is using it.<li>Pointer variables are not special because they are variables like any other variable. They have a memory allocation and they hold a value.</ul></section><div class=clearfix></div></div></div></div></div><div class=clearfix></div><div class=container-fluid><div class=row><div class=go-training-area><div class=col-md-12><h1 class=go-training-title>Go Training</h1><p>We have taught Go to thousands of developers all around the world since 2014. There is no other company that has been doing it longer and our material has proven to help jump start developers 6 to 12 months ahead of their knowledge of Go. We know what knowledge developers need in order to be productive and efficient when writing software in Go.<p>Our classes are perfect for both experienced and beginning engineers. We start every class from the beginning and get very detailed about the internals, mechanics, specification, guidelines, best practices and design philosophies. We cover a lot about "if performance matters" with a focus on mechanical sympathy, data oriented design, decoupling and writing production software.</div><div class="col-md-12 training-clients"><div class=training-clients-area><div class=training-clients-box><span><img alt="Capital One" src=https://www.ardanlabs.com/images/client-logos/white/training-client01.png></span></div><div class=training-clients-box><span><img alt=Cisco src=https://www.ardanlabs.com/images/client-logos/white/training-client02.png></span></div><div class=training-clients-box><span><img alt=Visa src=https://www.ardanlabs.com/images/client-logos/white/training-client03.png></span></div><div class=training-clients-box><span><img alt=Teradata src=https://www.ardanlabs.com/images/client-logos/white/training-client04.png></span></div><div class=training-clients-box><span><img alt="Red Ventures" src=https://www.ardanlabs.com/images/client-logos/white/training-client05.png></span></div></div></div><div class="col-md-12 corporate-training"><p>Interested in Ultimate Go Corporate Training and special pricing?</p><a href="mailto:hello@ardanlabs.com?Subject=Let’s%20Talk%20Ultimate%20Go%20Corporate%20Training%20and%20special%20pricing!" class="button btn-sm">Let’s Talk Corporate Training!</a></div><div class=clearfix></div></div><div class=video-training-section><div class=parent-flex><div class=info><h1>Join Our Online<br>Education Program</h1><p>Our courses have been designed from training over 4,000 engineers since 2013 and they go beyond just being a language course. Our goal is to challenge every student to think about what they are doing and why.</div><div class=image><a class="btn btn-lets-talk" href=https://www.ardanlabs.com/education target=_blank><i class="fa fa-plus" aria-hidden=true></i>Enroll Now</a></div></div></div></div></div></div><div class="modal fade" id=contactModal tabindex=-1 role=dialog aria-labelledby=exampleModalLabel aria-hidden=true><div class=modal-dialog role=document><div class=modal-content><div class=modal-body><div class=contact-modal-header><h1><i class="fa fa-comments-o" aria-hidden=true></i>Let's Talk</h1><p>Please fill out the form below and we'll get back to you soon.</p><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&times;</span></button></div><div id=success_confirmation><form name=contact-modal action=/api/contact/email method=post><div class="inner-form-wrap parent-flex"><div class=personal-info><h1><b>1.</b> Fill in your personal info</h1><div class="form-group name"><label class=required>Full Name</label>
<input name=name id=name class=form-control placeholder="Your name">
<label class=error for=name id=name_error>This field is required.</label></div><div class="form-group email"><label class=required>E-mail</label>
<input name=email id=email class=form-control placeholder="Your e-mail">
<label class=error for=email id=email_error>This field is required.</label>
<label class=error for=email id=email_error_sintax>Invalid email.</label></div><div class="form-group company"><label>Company</label>
<input name=company id=company class=form-control placeholder="Your company">
<label class=error for=company id=company_error>This field is required.</label></div><div class="form-group phone"><label>Phone</label>
<input name=phone id=phone class=form-control placeholder="Your phone number"></div></div><div class=message-info><h1><b>2.</b> Tell us about what you need</h1><div class="form-group reason" id=group_reason><label class="pull-left required">Reason for contact</label>
<select type=select class=form-control id=interests name=interests placeholder="What are you interested in?">
<option value><option value=caddy>Caddy Server
<option value=gotraining>Go Training
<option value=kubernetestraining>Kubernetes Training
<option value=blockchain>Blockchain Consulting
<option value=training-quote>Online Video Training
<option value=development>Development
<option value=staffaugmentation>Staff Augmentation
<option value=devops>Dev Ops
<option value=uiux>UI / UX
<option value=other>Other</select>
<label class=error for=reason id=reason_error>This field is required.</label></div><div class="form-group reason" id=group_forwho><label class="pull-left required">Is this for you or your company?</label>
<select type=select class=form-control id=is-for-company>
<option value><option value=false>For me
<option id=for-company value=true>For my company</select>
<label class=error for=is-for-company id=forwho_error>This field is required.</label></div><div class="form-group message" id=group_message><label class=required>What are you interested in?</label>
<textarea name=message id=message class=form-control type=text placeholder="Your message here..."></textarea>
<label class=error for=message id=message_error>This field is required.</label></div></div><div class=submit-wrap><input class="btn btn-lets-talk" value="Send Message" type=submit></div></div><div class=confirmation><img src=https://www.ardanlabs.com/images/form-confirm.svg><h2>Message Sent</h2><p>Check your email for confirmation of your sent message. We'll get back to you shortly.</p><button type=button class="btn btn-lets-talk" data-dismiss=modal aria-label=Close>
Finish</button></div></form></div></div></div></div></div><footer><div class=footer-below><div class=container><div class=row><div class=footer-flex><div class=ft-flex-general-link><ul class=footer-ul><div class=blue-line></div><li><a href=/training>Training</a><li><a href=/development>Development</a><li><a href=/devops-consulting>DevOps</a><li><a href=/blockchain>Blockchain</a><li><a class=consulting_click href=/staffing>Staffing</a><li><a href=/ui-ux>UI/UX</a><li><a href=/machine-learning>Machine Learning</a></ul><ul class=footer-ul><div class=blue-line></div><li><a target=_blank href=https://www.ardanlabs.com/education>Education</a><li><a href=/ardan-labs-live/>Live Events</a><li><a target=_blank href=https://ardanlabs.buzzsprout.com/>Podcast</a><li><a target=_blank href=https://www.youtube.com/channel/UCCgGRKeRM1b0LTDqqb4NqjA>YouTube</a><li><a href=/blog>Blog</a><li><a target=_blank href=https://store.ardanlabs.com/>Store</a></ul><ul class=footer-ul><div class=blue-line></div><li><a href=/about>About</a><li><a href=/news>News</a><li><a href=/my/contact-us>Contact</a><li><a href=/careers>Careers</a><li><a href=/my/lab>My Lab</a><li><a href=/terms-service>Terms of Service</a><li><a href=/privacy-policy>Privacy</a></ul></div><div class=ft-flex-reach-us><h6 class=heading7>Reach Us</h6><p><i class="fa fa-phone"></i>(888) 72 ARDAN<br><span>888 722-7326</span><p><a href=mailto:hello@ardanlabs.com><i class="fa fa-envelope"></i>hello@ardanlabs.com</a></div></div></div></div></div></footer><div class=bottom-footer><div class=footer-social-link><a href=https://twitter.com/ardanlabs target=_blank><i class="fa fa-twitter" aria-hidden=true></i>Twitter</a>
<a href=https://github.com/ardanlabs target=_blank><i class="fa fa-github" aria-hidden=true></i>Github</a>
<a href=https://ardanlabs.buzzsprout.com/ target=_blank><i class="fa fa-podcast" aria-hidden=true></i>Podcast</a>
<a href=https://www.youtube.com/channel/UCCgGRKeRM1b0LTDqqb4NqjA target=_blank><i class="fa fa-youtube-play" aria-hidden=true></i>YouTube</a>
<a href=https://www.linkedin.com/company/ardanlabs/ target=_blank><i class="fa fa-linkedin" aria-hidden=true></i>LinkedIn</a>
<a href=https://store.ardanlabs.com/ target=_blank><i class="fa fa-shopping-bag" aria-hidden=true></i></i>Store</a></div><div class=copyright><div class=container><div class=col-md-12><p>Ardan Labs Copyrights &copy; 2022</div></div></div></div><div class=clear-fix></div><script src=https://www.ardanlabs.com/js/bundle.min.c591bc854a48859ebd9ea96ddbac048004e6c9cc09252ae84d2f29b65a9741f5.js></script><script>$(document).ready(function(){$(".dropdown-toggle").dropdown();$('.carousel').carousel({interval:6000});$('#nav').on('affix.bs.affix',function(){if(!$(window).scrollTop())return false;});$("#ultimate-close").click(function(){$("section.ad-widget").addClass("hide-widget");});$("#contact-close").click(function(){$(".contact-widget-inner-corporate").addClass("hide-widget");$(".toggle-icon").addClass("show-toggle-icon");});$(".toggle-icon").click(function(){$(".contact-widget-inner-corporate").removeClass("hide-widget");$(".contact-widget-inner-corporate").addClass("instant-load");$(".toggle-icon").removeClass("show-toggle-icon");});$("#confirm-close").click(function(){$(".contact-widget-inner-corporate").addClass("hide-widget");});});$(document).ready(function(){$('[data-toggle="popover"]').popover({});$('[data-toggle="popover"]').click(function(){setTimeout(function(){$('.popover').fadeOut('slow');},5000);});});$(document).on('click','.navbar-collapse.in',function(e){if($(e.target).is('a')){$(this).collapse('hide');}});$('#myModal').on('hidden.bs.modal',function(){var $this=$(this).find('iframe'),tempSrc=$this.attr('src');$this.attr('src',"");$this.attr('src',tempSrc);});$(document).on('ready',function(){$('.slider-for').slick({slidesToShow:1,slidesToScroll:1,arrows:false,fade:true,draggable:false,asNavFor:'.slider-nav'});$('.slider-nav').slick({slidesToShow:3,slidesToScroll:1,asNavFor:'.slider-for',dots:true,draggable:false,focusOnSelect:true});});$(window).on('resize orientationchange',function(){$('.slider-nav').slick('unslick');$('.slider-nav').slick({slidesToShow:3,slidesToScroll:1,asNavFor:'.slider-for',dots:true,draggable:false,focusOnSelect:true});});</script><script>var rsslinkbtn=document.getElementById('rsslinkbtn');if(rsslinkbtn){var clipboard=new ClipboardJS(rsslinkbtn);clipboard.on('success',function(e){console.log(e);});clipboard.on('error',function(e){console.log(e);});}</script><script>!function(e,t,n,s,u,a){e.twq||(s=e.twq=function(){s.exe?s.exe.apply(s,arguments):s.queue.push(arguments);},s.version='1.1',s.queue=[],u=t.createElement(n),u.async=!0,u.src='//static.ads-twitter.com/uwt.js',a=t.getElementsByTagName(n)[0],a.parentNode.insertBefore(u,a))}(window,document,'script');twq('init','o26lj');twq('track','PageView');</script><script>_linkedin_partner_id="1254834";window._linkedin_data_partner_ids=window._linkedin_data_partner_ids||[];window._linkedin_data_partner_ids.push(_linkedin_partner_id);</script><script>(function(){var s=document.getElementsByTagName("script")[0];var b=document.createElement("script");b.type="text/javascript";b.async=true;b.src="https://snap.licdn.com/li.lms-analytics/insight.min.js";s.parentNode.insertBefore(b,s);})();</script><noscript><img height=1 width=1 style=display:none alt src="https://px.ads.linkedin.com/collect/?pid=1254834&fmt=gif"></noscript><script>(function(){window.ldfdr=window.ldfdr||{};(function(d,s,ss,fs){fs=d.getElementsByTagName(s)[0];function ce(src){var cs=d.createElement(s);cs.src=src;setTimeout(function(){fs.parentNode.insertBefore(cs,fs)},1);}ce(ss);})(document,'script','https://sc.lfeeder.com/lftracker_v1_ywVkO4XynoeaZ6Bj.js');})();</script><script>!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?n.callMethod.apply(n,arguments):n.queue.push(arguments)};if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';n.queue=[];t=b.createElement(e);t.async=!0;t.src=v;s=b.getElementsByTagName(e)[0];s.parentNode.insertBefore(t,s)}(window,document,'script','https://connect.facebook.net/en_US/fbevents.js');fbq('init','3572784256110371');fbq('track','PageView');</script><noscript><img height=1 width=1 src="https://www.facebook.com/tr?id=3572784256110371&ev=PageView&noscript=1"></noscript><script>!function(w,d){if(!w.rdt){var p=w.rdt=function(){p.sendEvent?p.sendEvent.apply(p,arguments):p.callQueue.push(arguments)};p.callQueue=[];var t=d.createElement("script");t.src="https://www.redditstatic.com/ads/pixel.js",t.async=!0;var s=d.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}}(window,document);rdt('init','t2_765ylmxh');rdt('track','PageVisit');</script></body></html>